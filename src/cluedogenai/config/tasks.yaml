create_scene_blueprint:
  description: >
    Using the current {game_state} and the latest {player_action}, design the
    next narrative scene of the murder mystery. Focus on:
    1. Where the scene takes place and who is present
    2. What is happening right now (summary and key dramatic beats)
    3. Which clues are visible to the player
    4. Which tensions or secrets are hidden beneath the surface
    5. What overall mood and visual hooks define this moment
  expected_output: >
    A valid JSON "scene_blueprint" object with at least:
    - "scene_id": unique id or name of the scene
    - "location": short description of the place
    - "summary": 2–4 sentences describing the current situation
    - "present_characters": list of character ids or names in the scene
    - "beats": ordered list of key dramatic beats
    - "visible_clues": list of clues that can be noticed now
    - "hidden_tension": 1–2 sentences about underlying conflict/secrets
    - "music_mood": a simple label for the audio agent (e.g. "tense", "calm")
    - "visual_hooks": list of strong visual elements for the vision agent
  agent: narrative_agent

define_characters:
  description: >
    Given the current scene_blueprint and the overall premise, define the full
    cast of suspects and any important NPCs.

  expected_output: >
    You MUST return ONLY valid JSON, with no markdown, no backticks and no extra text.
    The JSON must have EXACTLY this structure (field names must match):

    {
      "suspects": [
        {
          "id": "suspect_1",
          "name": "Full Name",
          "role": "Job/position in the tech company",
          "personality": "Short description (1–2 sentences)",
          "secret": "Hidden goal, fear or conflict",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": false
        },
        {
          "id": "suspect_2",
          "name": "Full Name",
          "role": "Job/position in the tech company",
          "personality": "Short description (1–2 sentences)",
          "secret": "Hidden goal, fear or conflict",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": false
        },
        {
          "id": "suspect_3",
          "name": "Full Name",
          "role": "Job/position in the tech company",
          "personality": "Short description (1–2 sentences)",
          "secret": "Hidden goal, fear or conflict",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": false
        },
        {
          "id": "suspect_4",
          "name": "Full Name",
          "role": "Job/position in the tech company",
          "personality": "Short description (1–2 sentences)",
          "secret": "Hidden goal, fear or conflict",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": true
        }
      ],
      "guilty_name": "Full Name of the guilty suspect"
    }

    Constraints:
    - Exactly 4 suspects.
    - Exactly ONE of them must have "guilty": true.
    - "guilty_name" must match the "name" of the guilty suspect.
    - Do NOT wrap this JSON in ```json fences or any other text.

  agent: character_agent
  context:
    - create_scene_blueprint


generate_suspect_dialogue:
  description: >
    Write the chosen suspect's answer to the detective's latest question,
    using the current scene_blueprint, the suspect profile and the existing
    game_state. Focus on:
    1. Staying in-character according to the suspect's personality and role
    2. Respecting the underlying case logic and previously revealed facts
    3. Optionally revealing small new facts or subtle hints
    4. Keeping the dialogue immersive and relatively concise
  expected_output: >
    A JSON object with:
    - "spoken_text": the suspect's answer in first person, natural dialogue
    - "inner_thoughts": meta-notes about what the suspect is thinking
                        (for internal use, not shown to the player)
    - "revealed_facts": list of new atomic facts that the backend should add
                        to the game_state
    - "implied_clues": optional list of subtle hints suggested by the answer
  agent: dialogue_agent
  context:
    - create_scene_blueprint
    - define_characters

design_scene_visuals:
  description: >
    Based on the current scene_blueprint, the involved characters and the
    latest suspect dialogue, design image generation prompts that visually
    capture the mood and key elements of the scene. Focus on:
    1. Location, lighting and atmosphere
    2. Important props and visible clues
    3. Framing and composition (what the "camera" sees)
    4. A consistent noir / tech-office aesthetic
  expected_output: >
    A JSON object with:
    - "primary_prompt": one detailed text prompt for image generation
    - "alternate_prompts": 1–2 shorter alternative prompts
    - "style_tags": list of style descriptors (e.g. "noir", "cinematic")
    - "safety_notes": optional notes on what to avoid (e.g. explicit gore)
  agent: vision_agent
  context:
    - create_scene_blueprint
    - define_characters
    - generate_suspect_dialogue

curate_scene_audio:
  description: >
    Using the current scene_blueprint, its music_mood and the emotional tone
    of the latest suspect dialogue, propose a soundtrack and soundscape for
    this scene. Focus on:
    1. Musical genre, mood, tempo and instrumentation
    2. Tension level (low/medium/high)
    3. Ambient sound effects that fit the location and situation
  expected_output: >
    A JSON object with:
    - "music_tags": list of tags describing genre, mood, tempo, instruments
    - "sfx_tags": list of short descriptions of sound effects
    - "prompt_snippet": 1–2 sentences as a prompt for an AI music generator
    - "intensity_level": "low" | "medium" | "high" tension
  agent: audio_agent
  context:
    - create_scene_blueprint
    - generate_suspect_dialogue

game_play_director_step:
  description: >
    Decide what should happen next in the game flow based on the global
    game_state, the defined characters and the latest interaction. Focus on:
    1. Which agent should act next (narrative, dialogue, vision, audio, etc.)
    2. Whether to escalate tension, introduce a new scene, or deepen an existing one
    3. When to offer hints or move towards the final reveal
  expected_output: >
    A JSON control object with:
    - "next_step": high-level description of the next action
    - "target_agent": which agent should be called next
    - "reasoning": brief justification for this choice
    - "flags": optional control flags such as
               "approach_final_reveal": true/false,
               "offer_hint": true/false
  agent: director_agent
  context:
    - create_scene_blueprint
    - define_characters
    - generate_suspect_dialogue
    - design_scene_visuals
    - curate_scene_audio
